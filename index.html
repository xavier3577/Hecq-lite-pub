<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>HECQ Secure ‚Äî Argon2id + AES-GCM</title>

<!-- Librairies -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/argon2-browser/1.18.0/argon2.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>

<style>
  body{
    margin:0;
    font-family:"Segoe UI",Roboto,Arial,sans-serif;
    background:radial-gradient(circle at top,#0d1117,#000);
    color:#e8eef6;
  }
  .container{max-width:800px;margin:24px auto;padding:0 16px}
  h1{text-align:center;margin-bottom:6px;
     color:#00eaff;text-shadow:0 0 12px rgba(0,234,255,.6)}
  .badges{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:16px 0}
  .badge{padding:6px 12px;border-radius:20px;font-size:13px;
         border:1px solid #333;background:#111}
  .ok{border-color:#1ec87c;color:#9fffc4}
  .warn{border-color:#c77c2e;color:#ffd9a6}
  .card{background:#111a2b;border:1px solid #24314a;border-radius:12px;
        padding:16px;margin:14px 0;box-shadow:0 0 18px rgba(0,234,255,.08)}
  label{font-weight:600;color:#9feaff;margin-bottom:6px;display:block}
  input,textarea{width:100%;padding:12px 14px;margin-bottom:8px;
    background:#0c1220;color:#fff;border:1px solid #2a3b55;border-radius:10px;
    font-size:15px;outline:none}
  textarea{min-height:110px;resize:vertical}
  .row{display:flex;gap:10px;align-items:center}
  .btn{border:0;border-radius:10px;padding:10px 16px;font-weight:600;color:#fff;cursor:pointer;
       background:linear-gradient(135deg,#00eaff,#9c4dff);
       box-shadow:0 6px 16px rgba(0,234,255,.2);transition:.2s}
  .btn:hover{transform:translateY(-1px);box-shadow:0 8px 20px rgba(156,77,255,.28)}
  .ghost{background:#0c1220;border:1px solid #2a3b55}
  .eye{min-width:44px;height:44px;display:grid;place-items:center;border:1px solid #2a3b55;
       border-radius:10px;background:#0c1220;color:#9cc0ff;cursor:pointer}
  .strength{height:10px;border-radius:6px;background:#222;margin-bottom:6px;overflow:hidden}
  .strength span{display:block;height:100%;width:0;background:linear-gradient(90deg,red,orange,yellow,lime);
                 transition:width .3s}
  .qr{display:grid;place-items:center;margin-top:10px}
  .disclaimer{margin:30px 0;padding:14px;border:1px solid #333;border-radius:8px;
              background:#0c1220;color:#aaa;font-size:12px;line-height:1.5;text-align:center}
</style>
</head>
<body>
<div class="container">
  <h1>HECQ Secure ‚Äî Argon2id + AES-GCM</h1>

  <div class="badges">
    <span id="badgeOnline" class="badge">√âtat‚Ä¶</span>
    <span id="badgeArgon" class="badge">Argon2‚Ä¶</span>
  </div>

  <!-- Mot de passe -->
  <div class="card">
    <label>Mot de passe</label>
    <div class="row">
      <input id="password" type="password" placeholder="Mot de passe robuste (12+ caract√®res)">
      <button id="toggleEye" class="eye">üëÅÔ∏è</button>
      <button id="genPass" class="btn">G√©n√©rer</button>
    </div>
    <div class="strength"><span id="strengthFill"></span></div>
  </div>

  <!-- Texte clair -->
  <div class="card">
    <label>Texte en clair</label>
    <textarea id="plain" placeholder="√âcris ton message ici"></textarea>
    <div class="row" style="justify-content:flex-end">
      <button id="encrypt" class="btn">Chiffrer</button>
      <button id="clear" class="btn ghost">Effacer</button>
    </div>
  </div>

  <!-- R√©sultat -->
  <div class="card">
    <label>R√©sultat (paquet chiffr√© JSON)</label>
    <textarea id="cipher" readonly></textarea>
    <div class="row" style="justify-content:flex-end">
      <button id="copy" class="btn ghost">Copier</button>
      <button id="makeQR" class="btn">G√©n√©rer QR</button>
    </div>
    <div id="qr" class="qr"></div>
  </div>

  <!-- D√©chiffrement -->
  <div class="card">
    <label>Texte chiffr√© √† d√©chiffrer</label>
    <textarea id="toDecrypt" placeholder="Colle ici le paquet JSON"></textarea>
    <div class="row" style="justify-content:flex-end">
      <button id="decrypt" class="btn">D√©chiffrer</button>
    </div>
    <textarea id="decrypted" readonly placeholder="R√©sultat du d√©chiffrement"></textarea>
  </div>

  <!-- Disclaimer -->
  <div class="disclaimer">
    ‚ö†Ô∏è <b>Disclaimer / Mentions l√©gales :</b><br>
    HECQ Secure est une application de chiffrement locale. Aucune donn√©e n‚Äôest envoy√©e ni stock√©e sur un serveur.<br>
    L‚Äôauteur d√©cline toute responsabilit√© en cas d‚Äôusage ill√©gal ou contraire aux lois en vigueur.<br>
    L‚Äôapplication est fournie <i>‚Äúen l‚Äô√©tat‚Äù</i>, sans garantie. L‚Äôutilisateur est seul responsable du choix de son mot de passe et de l‚Äôusage qui est fait de l‚Äôapplication.
  </div>
</div>

<script>
const $=id=>document.getElementById(id);
const enc=s=>new TextEncoder().encode(s);
const dec=b=>new TextDecoder().decode(b);
const b64e=u8=>btoa(String.fromCharCode(...u8));
const b64d=s=>Uint8Array.from(atob(s),c=>c.charCodeAt(0));

function setBadge(el,text,cls){el.className="badge "+(cls||"");el.textContent=text;}
function refreshOnline(){setBadge($("badgeOnline"),navigator.onLine?"En ligne":"Hors-ligne",navigator.onLine?"ok":"warn");}
window.addEventListener("online",refreshOnline);window.addEventListener("offline",refreshOnline);

// ≈ìil
$("toggleEye").onclick=()=>{let p=$("password");p.type=(p.type==="password")?"text":"password";};
// g√©n√©rer
$("genPass").onclick=()=>{const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*";
 let pass="";for(let i=0;i<21;i++)pass+=chars[Math.floor(Math.random()*chars.length)];
 $("password").value=pass;updateStrength(pass);}
$("password").addEventListener("input",e=>updateStrength(e.target.value));
function updateStrength(pw){$("strengthFill").style.width=Math.min(pw.length*5,100)+"%";}

// deriveKey
async function deriveKey(password,salt){
 if(window.argon2&&argon2.hash){
   try{
     const res=await argon2.hash({pass:password,salt,type:argon2.ArgonType.Argon2id,mem:65536,time:3,parallelism:1,hashLen:32});
     setBadge($("badgeArgon"),"Argon2id charg√©","ok");
     return crypto.subtle.importKey("raw",res.hash,"AES-GCM",false,["encrypt","decrypt"]);
   }catch(e){console.warn("Argon2 fail, fallback PBKDF2",e);}
 }
 setBadge($("badgeArgon"),"Repli PBKDF2","warn");
 const keyMaterial=await crypto.subtle.importKey("raw",enc(password),"PBKDF2",false,["deriveKey"]);
 return crypto.subtle.deriveKey({name:"PBKDF2",salt,iterations:100000,hash:"SHA-256"},
   keyMaterial,{name:"AES-GCM",length:256},false,["encrypt","decrypt"]);
}

// encrypt
$("encrypt").onclick=async()=>{
 try{
   const plain=$("plain").value.trim();const password=$("password").value;
   if(!plain||!password)return alert("Texte ou mot de passe manquant");
   const salt=crypto.getRandomValues(new Uint8Array(16));
   const iv=crypto.getRandomValues(new Uint8Array(12));
   const key=await deriveKey(password,salt);
   const ctBuf=await crypto.subtle.encrypt({name:"AES-GCM",iv},key,enc(plain));
   const packet={v:1,alg:"AES-GCM",kdf:(window.argon2&&argon2.hash)?"argon2id":"pbkdf2-sha256",
     params:(window.argon2&&argon2.hash)?{time:3,mem:65536,par:1}:{iter:100000},
     salt:b64e(salt),iv:b64e(iv),ct:b64e(new Uint8Array(ctBuf))};
   const json=JSON.stringify(packet);
   $("cipher").value=json;$("qr").innerHTML="";
   try{await navigator.clipboard.writeText(json);}catch{}
 }catch(e){alert("Erreur chiffrement : "+e.message);}
};
$("clear").onclick=()=>{$("plain").value="";$("cipher").value="";$("qr").innerHTML="";};
$("copy").onclick=async()=>{if(!$("cipher").value)return;try{await navigator.clipboard.writeText($("cipher").value);}catch{}};
$("makeQR").onclick=()=>{const t=$("cipher").value.trim();if(!t)return; $("qr").innerHTML="";new QRCode($("qr"),{text:t,width:180,height:180});};
$("decrypt").onclick=async()=>{
 try{
   const json=$("toDecrypt").value.trim();const password=$("password").value;
   if(!json||!password)return;
   const p=JSON.parse(json);const salt=b64d(p.salt),iv=b64d(p.iv),ct=b64d(p.ct);
   const key=await deriveKey(password,salt);
   const plain=await crypto.subtle.decrypt({name:"AES-GCM",iv},key,ct);
   $("decrypted").value=dec(plain);
 }catch(e){alert("Erreur d√©chiffrement : "+e.message);}
};

document.addEventListener("DOMContentLoaded",()=>{
 refreshOnline();
 setBadge($("badgeArgon"),(window.argon2&&argon2.hash)?"Argon2id charg√©":"Repli PBKDF2",
   (window.argon2&&argon2.hash)?"ok":"warn");
});
</script>
</body>
</html>